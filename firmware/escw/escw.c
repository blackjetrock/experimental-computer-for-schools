/**
 * Copyright (c) 2022 Raspberry Pi (Trading) Ltd.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

//
// Wifi support for the experimental schools computer added to this file.
//

#include <string.h>

#include "pico/cyw43_arch.h"
#include "pico/stdlib.h"

#include "lwip/pbuf.h"
#include "lwip/tcp.h"

#include "dhcpserver.h"
#include "dnsserver.h"

#include "../pico_main/fsms.h"
#include "../pico_main/esc_fsms.h"

#include "../pico_main/esc.h"
//E7E9EB
// orange:background-color:#FFA500 ;

#define KB_BODY "<!DOCTYPE html> \
<html>  \
<head>  \
  <link rel=\"stylesheet\" href=\"http://192.168.4.1/escfont\"> \
<style>  \
 tvf { \
        font-family: escfont; \
	//font-family: monospace, monospace; \
        font-size: 48px; \
      } \
\
body {			      \
font-family: escfont; \
  background-color:#f07351 ;  \
}  \
  \
#myDIV {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  line-height: 21px  \
}  \
  \
#myDIVs {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  line-height: 45px  \
}  \
#myDIVsb {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  line-height: 40px;   \
  font-size: 25px;  \
}  \
  \
#myDIV2 {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  offset-position: 10px;  \
  line-height: 21px  \
font-family = escfont; \
}  \
#myDIV2s {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  offset-position: 10px;  \
  line-height:45px;  \
}  \
#myDIV2sb {  \
  height:50px;  \
  width: 50px;  \
  background-color:#1010FF;  \
  color:#FFFFFF;  \
  border: 1px solid black;  \
  border-radius:300px;  \
  padding:10px;  \
  text-align: center;  \
  offset-position: 10px;  \
  line-height:45px;  \
  font-size:25px;  \
}  \
  \
table {  \
  border-collapse: collapse;  \
  <!-width: 100%;>  \
}  \
  \
#myTable2 {  \
  border-collapse: collapse;  \
  margin-left: 40px;  \
}  \
  \
th, td {  \
  padding: 8px;  \
  text-align: left;  \
  <!-border-bottom: 1px solid #ddd;>  \
}  \
 a:link {  \
  color: white;  \
  text-decoration: none;  \
}  \
 \
a:visited {  \
  color: white;  \
  text-decoration: none;  \
}  \
  \
</style>  \
</head>  \
  \
  \
<body>  \
  \
<h1>Experimental Schools Computer Simulation</h1>  \
 <p><pre><tvf>%s</tvf></pre></p> \
<table>  \
  <tr>  \
<th><div id=\"myDIV\"><a href=\"?key=2\">load<br>i.a.r.</a></div></th>  \
<th><div id=\"myDIV\"><a href=\"?key=3\">load<br>addr</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
  \
<th><div id=\"myDIVs\"><a href=\"?key=8\">clear</a></div></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=9\">-</a></div></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=10\">.</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=21\">A</a></div></th>  \
<th><div id=\"myDIVs\"><a href=\"?key=24\">run</a></div></th>  \
  \
</tr>  \
</table>  \
  \
<table id=\"myTable2\">  \
<tr>  \
<th><div id=\"myDIV2\"><a href=\"?key=4\">load<br>store</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=12\">1</a></div></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=13\">2</a></div></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=14\">3</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
  \
<th><div id=\"myDIV2\" style=\"line-height: 35px; font-size: 25px\"><a href=\"?key=22\">B</a></div></th>  \
<th><div id=\"myDIV2\" style=\"line-height: 35px\"><a href=\"?key=25\">stop</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIV2\" style=\"line-height: 35px\"><a href=\"?key=27\">dump</a></div></th>  \
  \
</tr>  \
</table>  \
  \
<table>  \
  <tr>  \
<th><div id=\"myDIV\"><a href=\"?key=5\">decr<br>addr</a></div></th>  \
<th><div id=\"myDIV\"><a href=\"?key=6\">incr<br>addr</a></div></trh>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=15\">4</a></div></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=16\">5</a></div></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=17\">6</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIVsb\"><a href=\"?key=23\">C</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIVs\"><a href=\"?key=28\">check</a></div></th>  \
  \
<tr>  \
</table>  \
  \
<table id=\"myTable2\">  \
<tr>  \
<th><div id=\"myDIV2\"><a href=\"?key=7\">normal<br>reset</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=18\">7</a></div></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=19\">8</a></div></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=20\">9</a></div></th>  \
<th><div id=\"myDIV2sb\"><a href=\"?key=11\">0</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIV2\"><a href=\"?key=26\">K I<br>reset</a></div></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th></th>  \
<th><div id=\"myDIV2s\"><a href=\"?key=29\">reload</a></div></th>  \
  \
</tr>  \
</table>  \
  \
  \
</body>  \
</html>"
  
#define TCP_PORT 80
#define DEBUG_printf printf
#define POLL_TIME_S 5
#define HTTP_GET "GET"
#define HTTP_RESPONSE_HEADERS             "HTTP/1.1 %d OK\nContent-Length: %d\nContent-Type: text/html; charset=utf-8\nConnection: close\n\n"
#define HTTP_RESPONSE_FONT_CSS_HEADERS   "HTTP/1.1 %d OK\nContent-Length: %d\nContent-Type: text/css; \nConnection: close\n\n"
#define HTTP_RESPONSE_FILE_DOWNLOAD      "HTTP/1.1 200 OK\nContent-Type: application/octet-stream\nContent-Disposition: attachment; filename=\"%s\"\nContent-Length: %d \nConnection: close\n\n"

#define LED_TEST_BODY							\
  "<html><body><h1>Experimental Schools Computer Simulation.</h1><p><pre>%s</pre></p>" \
 "<p><a href=\"?key=21\">A</a> " \
 "   <a href=\"?key=22\">B</a> " \
 "   <a href=\"?key=23\">C</a>"  \
  "  <a href=\"?key=2\"><span style=\"border: 2px solid #000; border-radius: 150px; padding: 5px;\">load<br>iar</span></a>" \
  "  <a href=\"?key=3\">LOAD ADDR</a>" \
  "  <a href=\"?key=4\">LOAD STORE</a></p>" \
  "  <p><a href=\"?key=5\">INCR ADDR</a>" \
  "  <a href=\"?key=6\">DECR ADDR</a>" \
  "  <a href=\"?key=7\">NORMAL RESET</a></p>" \
  "  <p><a href=\"?key=11\"><span style=\"border: 2px solid #000; border-radius: 150px; padding: 5px;\">0</span></a>" \
  "  <a href=\"?key=12\">1</a>" \
  "  <a href=\"?key=13\">2</a>" \
  "  <a href=\"?key=14\">3</a>" \
  "  <a href=\"?key=15\">4</a>" \
  "  <a href=\"?key=16\">5</a>" \
  "  <a href=\"?key=17\">6</a>" \
  "  <a href=\"?key=18\">7</a>" \
  "  <a href=\"?key=19\">8</a>" \
  "  <a href=\"?key=20\">9</a></p>" \
  "  <p><span style=\"width: 200px; height: 200px; border: 2px solid #000; border-radius: 150px; padding: 5px;\">Text here</span><a href=\"?key=0\">REFRESH</a>" \
 "</p>"
#define LED_TEST_BODY2 "<p>LED is %s</p><p><a href=\"?led=%d\">Turn led %s</a></p>"
#define LED_TEST_BODY3 "<p>LED is %s</p><p><a href=\"?led=%d\">Turn led %s</a></p>"
#define LED_TEST_BODY4 "<p>LED is %s</p><p><a href=\"?led=%d\">Turn led %s</a></p>"
#define END_BODY "</body></html>"
#define LED_PARAM "led=%d"
#define KEY_PARAM "key=%d"
#define LED_TEST "/ledtest"
#define FONT_TEST "/escfont"
#define FONT_FILE_TEST "/escfont/escfont.woff2"

#define LED_GPIO 0
#define HTTP_RESPONSE_REDIRECT "HTTP/1.1 302 Redirect\nLocation: http://%s" LED_TEST "\n\n"

#define EMBEDDED_FONT_URL_BODY " @font-face { \
  font-family: escfont; \
  src: url(http://192.168.4.1/escfont/escfont.woff2) format('woff2'); \
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; \
} "



//Embedded font
uint8_t embedded_font[] = {
			   
// ASSEMBLER_EMBEDDED_CODE_START

// Embedded ROM file: m8JXjfVPf62XiF7kO-i9YL1la1OD.woff2
0x77,0x4f,0x46,0x32,0x00,0x01,0x00,0x00,0x00,0x00,0x0d,0x48,0x00,0x11,0x00,0x00,
0x00,0x00,0x1e,0x4c,0x00,0x00,0x0c,0xea,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x1a,0x3e,0x1b,0x81,0x56,0x1c,0x1e,0x06,0x60,0x00,0x81,0x04,0x08,0x52,0x09,0x9c,
0x0c,0x11,0x08,0x0a,0x90,0x60,0x8f,0x11,0x0b,0x24,0x00,0x01,0x36,0x02,0x24,0x03,
0x3c,0x04,0x20,0x05,0x84,0x46,0x07,0x72,0x0c,0x81,0x32,0x1b,0x2c,0x1c,0xb3,0x11,
0x15,0x6c,0x1c,0x04,0xfc,0x98,0x5e,0x90,0xfc,0x17,0x09,0xbc,0x21,0xea,0xd3,0x23,
0xa4,0xa2,0x23,0x82,0x7d,0x31,0x80,0x4d,0x74,0x33,0x1c,0xc7,0xc1,0xea,0xcd,0xdd,
0xa9,0xff,0x69,0x27,0x97,0x2a,0x76,0xcf,0x1a,0x50,0x49,0xa0,0x8a,0x97,0x46,0x48,
0x32,0xeb,0x7f,0xdf,0x4f,0xad,0x73,0xef,0x83,0x4f,0xef,0x83,0x64,0xfb,0xdb,0x69,
0x39,0x8e,0x4c,0x2c,0x73,0xc2,0xe6,0xb0,0x1c,0x62,0x99,0x15,0x36,0x70,0xb5,0xd5,
0x04,0x03,0xb4,0x9e,0x9a,0xe5,0x2c,0x81,0x68,0x3b,0xb5,0x07,0x02,0xab,0x41,0x60,
0xe0,0x9a,0x17,0x3d,0x69,0xdb,0x3e,0x08,0x37,0x04,0xb6,0xca,0xd6,0x66,0x51,0xbf,
0x43,0x6c,0xaa,0x86,0xb9,0x97,0xed,0x20,0x42,0xac,0x11,0x93,0xdd,0x7f,0xa8,0x1c,
0x92,0x90,0x08,0x82,0xdc,0x76,0xff,0xd0,0x88,0x34,0x46,0xa0,0x05,0x32,0xdd,0x12,
0xdc,0xcc,0xd5,0x59,0x84,0x2a,0xcb,0x52,0xda,0xc7,0x8b,0x94,0x85,0x4c,0x41,0x2d,
0xbf,0x81,0x91,0x71,0x34,0x23,0x87,0x75,0x92,0x5f,0x9e,0x1c,0x5a,0x16,0xe0,0x0e,
0xf7,0xf1,0xbe,0xc7,0x53,0x31,0xbf,0x57,0x62,0xe8,0xfd,0xff,0xe6,0xfa,0xb2,0xef,
0x56,0x92,0xd3,0x3d,0xc3,0x19,0x40,0x10,0x0e,0x58,0x8e,0x70,0x64,0x4c,0x52,0xe9,
0xfc,0x4e,0x55,0xf2,0x29,0xf9,0x94,0xf4,0x50,0xba,0x07,0x01,0x3c,0x82,0x04,0x20,
0x35,0xe3,0x58,0xe1,0xae,0xf0,0x28,0x57,0xda,0x55,0xbb,0x56,0xef,0x32,0x9d,0x43,
0xbd,0x41,0xf4,0xdc,0x38,0x36,0x07,0x06,0xbe,0xd2,0x73,0xa2,0x44,0xfa,0x15,0xf3,
0x82,0xc0,0x68,0xd1,0xb9,0x01,0x46,0x07,0x62,0xdd,0x80,0x7b,0x36,0x88,0x00,0x04,
0x64,0x04,0x08,0x8e,0xd2,0xd0,0x44,0x45,0xbc,0x9b,0x8b,0xb4,0xc3,0x68,0x7c,0xf2,
0xdc,0x15,0xd8,0x90,0x00,0x50,0x2a,0x81,0x01,0x10,0x78,0x40,0x63,0x51,0x7e,0x3f,
0xb2,0x01,0x02,0x6c,0x21,0xa9,0x74,0xfb,0x95,0x89,0x08,0xc3,0x0d,0x09,0x2f,0xa5,
0xb7,0x21,0x5c,0x61,0xa0,0x90,0x64,0x60,0x70,0xcf,0x3c,0x42,0x51,0xfc,0x1e,0x44,
0x87,0xc0,0xb7,0x93,0x00,0x08,0x36,0x08,0xd7,0x54,0x23,0xb4,0x30,0x90,0x38,0xa8,
0xd7,0x41,0x2e,0x88,0xbe,0x20,0x1e,0x81,0x20,0x41,0x60,0x08,0x68,0x28,0x00,0x2d,
0x80,0xba,0x16,0xd5,0x53,0x63,0x44,0x5b,0x4a,0xa3,0x2d,0x5e,0x31,0x50,0x99,0x57,
0xf6,0xc4,0x7f,0x75,0x59,0xb8,0x0f,0x5b,0xae,0x76,0x0c,0x78,0xba,0xe4,0x6f,0xd1,
0x3f,0x14,0xc0,0xef,0xe1,0x1b,0x00,0xce,0x1e,0x5e,0x98,0xee,0xa1,0x57,0x11,0xeb,
0xa1,0x5f,0x00,0xa6,0xbc,0xc1,0xd5,0x73,0x36,0x8b,0x6f,0x61,0x64,0xa5,0xa5,0x2e,
0x69,0x40,0xfc,0x5e,0x84,0x51,0x0b,0xfa,0x37,0x7f,0x0d,0x7a,0x9a,0x00,0x73,0xd8,
0xba,0x9c,0x00,0xe9,0x12,0xcb,0x6e,0x1c,0xf6,0x57,0xd3,0x18,0xf1,0x1d,0xca,0xb4,
0x4d,0xcf,0xd1,0x47,0x04,0x09,0x29,0xec,0x74,0x9a,0x0b,0xac,0xf4,0x6f,0x53,0x42,
0xa1,0x0e,0x84,0xa8,0x59,0xfa,0x56,0x29,0xc4,0xbb,0x1f,0x28,0xcb,0x6e,0xbf,0xe3,
0xbf,0x63,0xde,0x91,0x3f,0xfb,0x93,0xd9,0x52,0x24,0x41,0x02,0x57,0x51,0xc2,0x86,
0x05,0x07,0x9d,0x28,0xb0,0xa8,0x08,0x97,0xb0,0x45,0x68,0x0b,0x77,0x73,0x05,0x20,
0x1c,0xed,0x06,0xf4,0x4b,0x50,0xb5,0x31,0x9d,0x2c,0x2c,0xfe,0x77,0xb5,0x3d,0x80,
0xc0,0x7d,0xd9,0xba,0xf4,0xfd,0x13,0x8c,0x5c,0x7f,0x8f,0xbe,0xfd,0xb3,0xd0,0x3f,
0x4f,0xcb,0x73,0x3d,0x69,0xbe,0xfa,0x04,0x7b,0x7b,0x6a,0x8b,0x2d,0x73,0x47,0xbb,
0x1b,0x62,0x04,0xcf,0x80,0xb6,0x59,0x10,0x64,0xac,0xe6,0x04,0x81,0x74,0x3a,0x25,
0x18,0x16,0x2d,0x26,0x04,0x34,0xdd,0x17,0x53,0xcf,0x5c,0xc8,0x6b,0xca,0xa8,0x5a,
0x73,0xe7,0xa9,0x75,0xee,0x8d,0x9d,0x84,0xf9,0xeb,0xb9,0x30,0x06,0x73,0xdd,0x26,
0xe4,0xd5,0xf9,0xc2,0x1d,0x1d,0xac,0x99,0xda,0xef,0x97,0x22,0xcc,0xf5,0x12,0x14,
0x17,0x77,0x5f,0x12,0x4c,0xcb,0x4b,0x59,0x98,0x5c,0xd7,0x6c,0xe0,0xaa,0xdc,0xf3,
0x25,0x0e,0x1d,0x5a,0x49,0xce,0x26,0x22,0x15,0x2c,0xd4,0x78,0xa3,0xd8,0xa6,0x7a,
0xdb,0xa0,0x49,0x7c,0xeb,0x80,0xac,0xfe,0x5c,0x5a,0xc2,0x30,0xb7,0xc7,0x2d,0x7a,
0xbf,0x44,0x84,0xfb,0xd9,0x5f,0xe5,0x62,0xf6,0x30,0xdf,0x50,0x2e,0x5c,0xf5,0xc5,
0xb0,0xf1,0x39,0xd8,0x9b,0x76,0xf0,0xd9,0xd5,0x41,0xdc,0x26,0x5a,0x88,0x8d,0x31,
0x4e,0x58,0x46,0x66,0x98,0xe9,0x5b,0xb3,0xe8,0xa4,0xf9,0x3d,0xb9,0x26,0x57,0xd4,
0xa1,0x4c,0x93,0xa5,0xdb,0x63,0x83,0x34,0x58,0x51,0xdd,0xf7,0x1f,0x03,0x3b,0x86,
0x47,0x70,0x53,0xc0,0x29,0x12,0x71,0xe4,0x04,0xc2,0x6a,0xe6,0xac,0x39,0x6d,0x4f,
0x22,0x39,0x32,0x3d,0xe3,0x89,0x92,0x59,0xf7,0xa9,0x39,0x14,0xdd,0x9d,0x20,0xff,
0x88,0xc4,0xb4,0xec,0x09,0x05,0x6d,0x85,0xf4,0x36,0x09,0x8b,0x87,0x82,0x65,0x19,
0xdb,0x72,0x88,0xd1,0xa1,0x94,0xd0,0x3e,0x37,0x28,0xc5,0x29,0xdd,0x6a,0x65,0x51,
0xf0,0x31,0x7b,0x61,0x0c,0xfc,0xa0,0x02,0x4e,0x2a,0x46,0x35,0xe3,0xc6,0x87,0xa1,
0xe6,0xf4,0xdf,0xa7,0x42,0xec,0x99,0x6e,0x47,0x56,0x77,0x4a,0x3d,0x84,0x76,0xe6,
0xc5,0x3c,0xba,0x18,0xbe,0x2d,0x50,0x0c,0xa1,0xb1,0x87,0x73,0xb7,0x84,0x05,0x1c,
0xae,0x16,0x74,0xc4,0x9a,0xec,0x0f,0xe6,0x58,0x36,0x01,0xcb,0x0d,0x6e,0x9d,0xa0,
0x36,0x94,0xb0,0x9a,0x09,0x07,0xd2,0x56,0x04,0x3c,0x3e,0x91,0x32,0x2b,0x25,0x59,
0x86,0x93,0xd3,0x05,0x75,0x63,0xf1,0x83,0x5c,0x2c,0xce,0x88,0x8c,0x6d,0xf3,0xbb,
0x31,0x7b,0xc8,0x5b,0x3d,0x9b,0x3c,0xa3,0xe8,0xd9,0x14,0x0d,0x10,0xe9,0x55,0xdb,
0xb9,0x3e,0x6b,0xf2,0xb8,0x8f,0xf9,0xa8,0xcc,0x24,0x3d,0xcf,0xb0,0xd7,0xe6,0x41,
0xb8,0xb5,0x8d,0x9e,0x6d,0xf1,0x65,0x14,0xd3,0xf0,0x08,0xac,0xb5,0xa6,0x80,0x8f,
0xea,0x83,0xdd,0xf7,0x87,0x44,0xec,0x1f,0x4a,0x0c,0x16,0xfd,0xdd,0x98,0x08,0xd1,
0xb9,0x63,0x9f,0xf9,0xbc,0x49,0x44,0x80,0x92,0x44,0xc8,0xef,0xa4,0x98,0xd5,0x14,
0xcb,0x4e,0x84,0xc1,0x0d,0xa2,0x38,0x91,0x40,0x63,0x79,0xe6,0x93,0xeb,0x89,0x94,
0xb9,0xb9,0x3e,0x93,0x60,0xd5,0x3c,0xad,0x24,0x2c,0x5b,0x22,0x89,0xef,0x7f,0x2d,
0x5d,0x7e,0x6d,0xfc,0x75,0xfc,0x6f,0x3b,0x4f,0x94,0xe1,0xfb,0x3b,0xe5,0xfb,0x5f,
0xce,0x14,0x87,0xa8,0x94,0xb2,0x0e,0xcb,0xd1,0x31,0xb1,0xfe,0xcd,0x49,0x82,0xc7,
0x43,0x39,0x93,0x88,0x0e,0x08,0x7b,0xee,0x61,0x8d,0xe8,0xe1,0x50,0x69,0x42,0xf8,
0xa1,0x74,0x92,0xb1,0x8a,0xc4,0xd1,0xfc,0x1e,0xd5,0x1d,0x47,0xcd,0x68,0xb7,0x79,
0x7d,0x2f,0xb0,0x10,0x9b,0xc5,0x9a,0xcf,0xea,0x84,0xdc,0x13,0x21,0x73,0xb1,0x86,
0x88,0xad,0x4b,0x1c,0x9f,0xd8,0x21,0x65,0xb6,0x81,0x08,0x36,0x17,0x0a,0x61,0xf6,
0xc1,0x2a,0x70,0xa1,0xa3,0x63,0xff,0xd7,0x42,0xd2,0xb2,0xb6,0x04,0x96,0xf1,0x0d,
0x4e,0x59,0xf5,0x71,0xd5,0xcc,0x45,0x49,0x5c,0xb8,0x76,0x21,0xe7,0x1c,0x04,0x2a,
0x7f,0x69,0x28,0xf7,0xf2,0xbe,0xc8,0x7b,0xe3,0xfc,0x6b,0x9e,0x88,0xd1,0x51,0xac,
0x12,0x95,0x90,0x11,0x55,0x31,0xa6,0x7d,0x4c,0xd0,0x33,0x4c,0x52,0x8a,0x29,0xaa,
0x66,0x9a,0xf6,0x33,0x8b,0x6a,0x98,0x4d,0x07,0x98,0x33,0xba,0x1d,0x96,0x82,0xdb,
0xa2,0xd3,0xf7,0xbf,0x16,0xd3,0x00,0xbd,0x5f,0x31,0x87,0x26,0x3a,0x28,0x12,0xb1,
0xfa,0xd3,0x6b,0x67,0xa2,0x49,0xfd,0xbd,0x62,0x69,0x5c,0x20,0x8c,0xae,0x8e,0x83,
0xf2,0xc3,0x09,0x07,0xab,0xb9,0x88,0x5a,0x28,0xea,0xa0,0xa8,0x87,0xa2,0x01,0x8a,
0x46,0x28,0x9a,0xa0,0x68,0x86,0xa2,0x05,0x8a,0x56,0x28,0xda,0xa0,0xb9,0x2e,0x68,
0xcc,0x5a,0xea,0x9e,0xbd,0x52,0x95,0xb4,0xb6,0x9e,0xbb,0x8e,0x6b,0x96,0x12,0x5d,
0x65,0x5b,0x94,0xc1,0x81,0x13,0xd5,0xd5,0x69,0x26,0x7a,0x20,0xed,0x95,0xd0,0xac,
0xb5,0x1b,0x76,0x73,0x5f,0x77,0x26,0x19,0x02,0x40,0xbd,0xa9,0x2e,0xdb,0x83,0x9e,
0xfd,0xa2,0xbb,0x13,0x3d,0xcd,0xae,0x42,0xb1,0x2d,0xef,0xbb,0xa3,0x5e,0x9f,0x8f,
0xd6,0x9d,0x2d,0xd7,0x0f,0x7d,0x62,0xfd,0xa8,0x01,0x5c,0x00,0x5b,0xd9,0x37,0x7b,
0x74,0x28,0xda,0xc3,0x49,0x8f,0x45,0xf9,0x00,0x02,0x60,0xfc,0x0b,0xbb,0xd1,0xfb,
0x43,0xe1,0xee,0x15,0x19,0x84,0x46,0xed,0x5d,0xa8,0x00,0x14,0xbf,0xa1,0xc4,0x10,
0x86,0xe7,0xc6,0xc4,0x41,0xfa,0x18,0xe2,0xf1,0x66,0xd1,0x43,0xe8,0x2c,0xf1,0x1b,
0x1a,0x78,0x04,0xec,0x8a,0xf9,0x88,0xdf,0xce,0xef,0x39,0xb4,0xbd,0x35,0x95,0xbb,
0x21,0x3a,0x64,0x79,0x39,0x18,0x42,0x71,0xfd,0xdd,0xc4,0x61,0x80,0x92,0x4a,0xcb,
0x48,0x47,0x3a,0xed,0xc3,0xbb,0x91,0x51,0x3c,0xae,0xee,0xcd,0x5d,0x26,0x8d,0xf3,
0xc1,0x5f,0x1f,0x8e,0x04,0x1a,0xd0,0x0c,0xa1,0x2d,0x0b,0x44,0x62,0xfa,0xbe,0xf2,
0xe6,0xc3,0xd7,0xe5,0xbe,0xd4,0xab,0x1a,0xee,0xcb,0xea,0xea,0x9c,0xe7,0x6c,0xc2,
0xa5,0xe6,0x7a,0xa1,0x4b,0xb4,0x5d,0x45,0xf3,0x92,0x9d,0x56,0x05,0xc5,0x27,0xd3,
0x2d,0x24,0xeb,0x64,0x28,0xb6,0x69,0x27,0x96,0x6c,0xa1,0x95,0xf5,0x6e,0xb7,0x46,
0xb1,0xb0,0x99,0x1e,0x9e,0x5c,0xd9,0xae,0xdd,0x08,0x86,0xcb,0x1d,0xec,0xb8,0x34,
0xb4,0xd7,0xaa,0x5a,0x1a,0x10,0xb6,0x14,0x15,0x5e,0x32,0xca,0x1b,0x4a,0x71,0x84,
0xac,0x06,0xc2,0x5c,0x08,0x60,0xdf,0x4d,0x57,0x31,0x37,0xc1,0x13,0x47,0xc3,0xd1,
0x95,0x24,0x54,0x55,0x61,0xe3,0x8d,0x79,0xe2,0x58,0x80,0xcb,0xe2,0xec,0x10,0xd7,
0xcc,0x13,0x59,0x70,0x9c,0x6c,0x8d,0x28,0x15,0x6c,0x63,0xd8,0xc3,0x5d,0x19,0x34,
0x5a,0x0c,0xe9,0xc9,0x18,0xa1,0xe2,0x11,0xa2,0x7d,0xb0,0xd9,0xb7,0xef,0x2f,0xa9,
0x48,0xae,0xb5,0xe0,0xed,0x84,0x49,0xcb,0xfb,0x82,0x13,0x2b,0x2b,0x01,0xf6,0xfc,
0x94,0x95,0x74,0x3a,0x4d,0xf3,0xe2,0x3c,0x65,0x18,0xa6,0x21,0x90,0x7f,0xf3,0x8e,
0x4a,0x96,0x43,0x38,0xf3,0xa2,0xd1,0x87,0x9e,0x09,0x53,0xab,0xc4,0x08,0xc3,0x90,
0x67,0xe1,0xb0,0xf5,0x51,0xf1,0x75,0x16,0x3a,0xe3,0x31,0x70,0x38,0x6a,0x9d,0x75,
0x1c,0x1c,0x89,0x73,0xda,0xf0,0x32,0xdb,0xc7,0xf9,0x20,0xfd,0x6c,0x68,0x0e,0x64,
0x9e,0x68,0x22,0x40,0x59,0xa2,0x5e,0x15,0xfc,0x69,0x0d,0x63,0x79,0xfc,0x3c,0x4b,
0xe7,0x37,0x8d,0x1a,0xec,0x86,0x89,0xdf,0xf1,0x49,0x74,0xb7,0xcb,0x33,0x28,0xf3,
0xfa,0x5f,0xb1,0x2f,0x64,0xee,0x16,0xbf,0x97,0x9d,0x38,0xda,0x8d,0x10,0x4b,0xa6,
0x34,0xba,0xad,0x74,0x72,0x34,0x56,0x57,0x81,0x11,0xa7,0x06,0x86,0x29,0x8d,0xd6,
0xd8,0x0e,0xa5,0xfd,0x80,0xd3,0x5e,0x71,0xe9,0xfb,0x0b,0xae,0x72,0xe7,0xda,0x2a,
0x39,0xd8,0xec,0x97,0x33,0x93,0xce,0xa2,0x23,0x74,0x8a,0x19,0xa2,0xf1,0x39,0x70,
0xe8,0x4b,0xe7,0xef,0x87,0x72,0x6b,0x1a,0xb4,0x9b,0xeb,0x73,0xc0,0xfc,0x2c,0xb2,
0xba,0x98,0xf3,0xf5,0x6c,0x53,0x58,0x20,0x93,0x1c,0x17,0x98,0x0b,0x50,0xb4,0x32,
0x42,0x8c,0x41,0x71,0x5d,0x3a,0x89,0x04,0x83,0x92,0x95,0x11,0x52,0x8c,0xd9,0xd3,
0xb8,0x2f,0x61,0x8c,0x21,0xa3,0x40,0xd9,0x2a,0x08,0x39,0x05,0xca,0xd7,0x92,0x08,
0x05,0x05,0x2a,0x56,0x41,0x28,0x29,0xc8,0xb2,0x59,0x4c,0xb0,0x0a,0x87,0x54,0xad,
0x8c,0x50,0x63,0x50,0x5d,0x97,0x4e,0xa1,0xc1,0xa0,0x66,0x65,0x84,0x16,0xc3,0x6d,
0xdb,0x86,0x71,0xd6,0xb1,0x2a,0xea,0x56,0x41,0xe8,0x29,0x50,0xbf,0x96,0x44,0x18,
0x28,0xd0,0xb0,0x0a,0xc2,0x48,0x61,0xe6,0x18,0x5d,0x26,0x8a,0xee,0x04,0x53,0x8c,
0x2f,0xd5,0x29,0x02,0x39,0xf3,0xbc,0x05,0x11,0x8e,0x9f,0xa3,0xc3,0x46,0x0b,0x0d,
0x65,0xa9,0x41,0xab,0x72,0x59,0xc5,0x58,0xab,0x16,0x1b,0xd5,0x7a,0xdb,0x63,0x84,
0xb4,0x03,0xf0,0xb1,0xb7,0xa9,0xe8,0xa0,0x41,0xc7,0x72,0x39,0x95,0x38,0xa9,0x0e,
0x67,0xd5,0xe1,0xa2,0x3a,0x5c,0x6d,0x40,0x37,0x0d,0xba,0x6b,0x88,0x07,0x4a,0x78,
0x78,0xaa,0x1e,0x5e,0xaa,0x87,0xb7,0xea,0xe1,0x63,0x03,0xfa,0x6a,0xd0,0x4f,0x23,
0xf7,0xc7,0x12,0x79,0xbb,0x9d,0x05,0x8e,0x9e,0x5f,0x64,0x47,0xf3,0xfc,0x62,0x31,
0x44,0xf7,0xbc,0xc2,0xfe,0x46,0xac,0x1c,0xce,0x1f,0xd8,0xb7,0x49,0x55,0x82,0x40,
0xa5,0x12,0x42,0xac,0x2b,0x27,0xbc,0x9f,0x3a,0x40,0x33,0x90,0x0d,0xd0,0x51,0x00,
0x55,0x80,0x72,0x90,0x9f,0x03,0x83,0x4b,0x25,0x08,0x28,0x08,0xe8,0xaa,0x19,0xa8,
0x80,0x0f,0x3a,0x90,0xd2,0x48,0x63,0xa4,0x0d,0x21,0x33,0x5a,0xea,0x13,0x56,0x27,
0x23,0xc8,0x31,0xaf,0xe4,0x29,0x5f,0x5e,0xf3,0x84,0xeb,0x09,0x8f,0x3c,0x78,0xec,
0x92,0x0b,0x99,0x71,0x73,0xb4,0x60,0xd8,0xd2,0x1d,0xf2,0xdc,0xcf,0xba,0xe4,0x4d,
0x93,0xcb,0x32,0xf9,0x4a,0xf8,0xb8,0xd1,0x72,0xc4,0x11,0xa6,0x6b,0xf8,0x22,0xe2,
0xdb,0xc4,0xe6,0x7b,0x10,0xd3,0xae,0x08,0x86,0xae,0x4f,0x70,0xaf,0xe0,0xd6,0x47,
0xe5,0xba,0x8b,0xfb,0x57,0xc3,0xfa,0xc8,0x87,0x6b,0x2f,0x3f,0x28,0x13,0x2e,0xec,
0x88,0x9f,0x25,0x0f,0x26,0x3f,0x07,0x53,0x6e,0x79,0xae,0xc9,0x55,0x5d,0x7c,0xa5,
0xdb,0xe1,0xe3,0x54,0x61,0x65,0x6b,0x65,0x6f,0xb7,0xb0,0x55,0x68,0x2b,0xfc,0xbb,
0x50,0x28,0x16,0x80,0x53,0x8c,0x4b,0x6d,0x15,0xb7,0x8b,0x03,0xbb,0x7f,0x29,0x60,
0x2d,0x68,0x74,0xd6,0x44,0x13,0xdf,0x68,0x2e,0x7b,0xc4,0x4a,0x37,0xf7,0x1a,0x67,
0xaf,0x72,0xb6,0x0e,0xe5,0x66,0x6b,0xf3,0xca,0x7f,0xc9,0x2e,0x5a,0xdf,0x2a,0x79,
0x5d,0xb8,0xb5,0xfb,0x2f,0x57,0xbc,0xb7,0x4b,0xb2,0x13,0xce,0x01,0xca,0xa0,0x3d,
0x9b,0x6c,0xde,0x19,0xc4,0xc4,0x1c,0x2f,0x8b,0x52,0x76,0xc4,0xd7,0xb4,0xac,0xa7,
0xb4,0x60,0x77,0x77,0x6a,0x2a,0x0e,0xcd,0x8f,0x18,0x6a,0xd3,0x03,0x8b,0x9a,0x2b,
0xd7,0xa4,0x70,0xec,0xa8,0xde,0xbd,0xbf,0x10,0xca,0x33,0xbb,0xbd,0xd4,0x50,0xf0,
0xaf,0xf4,0xfa,0x55,0x0e,0xed,0xfe,0xab,0xf0,0xef,0x42,0x13,0x57,0x42,0x00,0x34,
0x82,0x02,0x5a,0x52,0x44,0x4f,0x32,0x85,0x97,0xeb,0x04,0xa0,0x00,0xf1,0x8a,0xf8,
0xfd,0xe1,0xaf,0xf8,0xaf,0xe2,0xd1,0x70,0x33,0xc6,0x02,0x20,0x18,0x22,0x0f,0x26,
0xe2,0xeb,0x60,0xa6,0x9c,0x24,0x62,0x9a,0x02,0x2c,0xad,0x24,0x04,0x44,0x42,0xe9,
0xca,0xf6,0xe1,0x5e,0x68,0x48,0xa1,0x65,0x1e,0x96,0x45,0x39,0x10,0x55,0x9c,0x67,
0x02,0x44,0xce,0x56,0x2c,0x44,0x2c,0xb2,0x40,0x18,0xf8,0x06,0x1e,0xbc,0x04,0xac,
0x70,0xac,0xd4,0x65,0xcd,0xab,0xa0,0x24,0xc8,0xdc,0x17,0x81,0x94,0x96,0xb1,0x2f,
0x68,0xe0,0x3a,0xc6,0xcd,0xc3,0xf7,0xad,0x1c,0x2c,0xab,0xe2,0xbc,0x4d,0x5a,0x3b,
0xb9,0xd0,0x63,0xc7,0x89,0x9d,0xac,0x31,0x40,0x6a,0xec,0xab,0x32,0x95,0xe6,0x7f,
0xff,0x98,0x30,0xf0,0x55,0xb3,0xc8,0x5f,0x11,0x76,0xfe,0xda,0x20,0x09,0x79,0x32,
0x22,0xa5,0xa5,0xca,0xc3,0x85,0xe3,0xb9,0x4e,0x1e,0x1e,0x6c,0xe3,0xd9,0x79,0x98,
0x24,0xf9,0x81,0xf1,0xf3,0x09,0xb2,0x2c,0x9d,0x83,0xd6,0x15,0xe7,0x11,0x04,0x61,
0xae,0x8c,0xc2,0x30,0x0e,0xb3,0xd5,0xd5,0x51,0x64,0x8c,0x94,0xd5,0x07,0xaa,0x0f,
0xd4,0xec,0x8f,0x52,0x91,0x66,0xbb,0x0b,0x4d,0x68,0x84,0x2e,0x3d,0xe9,0x24,0xa9,
0x2c,0x07,0xb3,0x8e,0xda,0x24,0x8c,0xc3,0x8c,0xc4,0xeb,0x37,0x8b,0x89,0x38,0xa7,
0x89,0xb9,0xe2,0x3c,0xa4,0x54,0x39,0x97,0x94,0x8a,0x55,0x56,0xee,0x4c,0x20,0xea,
0x91,0xa4,0xf4,0xe0,0xe1,0x2f,0xfd,0x69,0xc1,0x5f,0x2a,0xbd,0xcc,0x40,0xfb,0xff,
0x90,0xbf,0x36,0x3c,0x12,0x92,0xad,0x1d,0x6d,0xaf,0xc2,0x73,0x8d,0xf1,0x56,0x1d,
0xa3,0x80,0x59,0xf7,0x72,0x22,0x72,0x3d,0xc7,0xcd,0x43,0x6b,0x9f,0x15,0xc1,0x68,
0x9a,0x5e,0xce,0xf7,0x63,0x3f,0x9b,0x1a,0x1e,0x53,0xe3,0x3b,0x2f,0x34,0xc7,0xd8,
0xf5,0xcc,0x0b,0xcd,0x9c,0x37,0x87,0xdb,0xe2,0x38,0x99,0x0c,0x48,0x26,0x4e,0xc5,
0xa1,0x08,0x93,0x15,0x49,0x41,0x66,0xb0,0x44,0xf4,0x1f,0x4c,0x26,0xe0,0x1f,0x3c,
0x64,0xaf,0xd7,0x0f,0xa5,0x49,0x5d,0x07,0x6c,0xb2,0x60,0xcd,0x41,0x08,0xce,0xa1,
0x78,0x72,0x92,0x88,0xc2,0xb3,0x68,0xac,0xb3,0x00,0x42,0x84,0x97,0xf6,0x05,0x44,
0xfb,0xef,0xd4,0x20,0x88,0x24,0x41,0x11,0xf2,0x02,0x9e,0xce,0xb3,0x72,0x20,0xaf,
0x98,0xf5,0x51,0xf4,0xfc,0xf8,0x70,0x33,0x13,0x88,0x70,0x3d,0x09,0xa0,0x9c,0x12,
0x52,0x10,0x68,0x4a,0x4a,0x40,0x5a,0xd2,0xd2,0xea,0x52,0x4e,0x6a,0xcb,0x20,0x01,
0xc6,0x85,0x92,0x8d,0x08,0xc0,0xf2,0x03,0x21,0x2e,0x7e,0x08,0x5d,0xb0,0x88,0x61,
0xc1,0x0a,0x47,0x50,0xd6,0x3e,0x91,0x06,0x0c,0x62,0x02,0xa1,0x0a,0xd0,0x4f,0x98,
0xab,0x4b,0x10,0x69,0x32,0x32,0xa9,0x12,0x2b,0xc5,0xcc,0x6f,0x87,0xac,0x72,0xb6,
0xc5,0x6a,0xb6,0x29,0x29,0x65,0x28,0xff,0xd8,0xf2,0x14,0x07,0x69,0xee,0x20,0x05,
0x67,0xa4,0xda,0x67,0x6a,0x03,0x60,0x0c,0x9a,0xf8,0x88,0x08,0x00,0x61,0x74,0xfe,
0xed,0xad,0x91,0x5c,0x78,0xf4,0x3f,0x76,0x28,0x7e,0x0f,0x00,0x5f,0xae,0x2a,0x86,
0x00,0xf0,0xd3,0x1f,0x7e,0x4c,0x95,0x26,0x4a,0x5a,0x2e,0x90,0x5a,0x6a,0x30,0x30,
0x92,0x80,0x9f,0xda,0x45,0xf2,0x97,0x07,0xc9,0x77,0x3e,0x78,0x04,0x10,0xd6,0xae,
0xff,0x2b,0x78,0x0b,0x7f,0xdd,0x55,0x2d,0x8f,0x6c,0x32,0x3f,0x4c,0xe3,0x92,0x90,
0xde,0x2c,0x4d,0x00,0x12,0x1a,0x28,0xf4,0x24,0x46,0x87,0x5b,0xde,0x0f,0xe0,0xd5,
0xc0,0x80,0x19,0x9e,0x65,0x63,0x91,0x00,0x49,0x07,0xc0,0x67,0xa8,0xab,0xdf,0x96,
0x50,0x1e,0xcf,0xb4,0x65,0x04,0x64,0xda,0x0a,0x1c,0xf6,0x93,0xb6,0x12,0x0d,0x3e,
0xd1,0x56,0xe1,0x8a,0x5b,0x42,0xaf,0xb4,0x41,0x11,0x34,0x93,0x81,0xfb,0xd6,0x53,
0x87,0xcb,0xd6,0x1c,0xd6,0x6d,0xc2,0xd9,0xe7,0xac,0x7a,0x60,0x99,0xe8,0x6b,0xba,
0x8c,0x56,0x3c,0xc6,0x62,0x69,0x21,0xf2,0x27,0x73,0x4f,0x99,0x74,0xce,0x65,0x90,
0xff,0x48,0x40,0x2c,0xa4,0xc9,0x4f,0x75,0xba,0x04,0xc3,0xbc,0x8d,0xa5,0x98,0x21,
0xe2,0xda,0xc0,0x5d,0x55,0x21,0x96,0x0e,0x16,0x4f,0xeb,0xd1,0x25,0x23,0x03,0x33,
0x47,0xa4,0x0d,0x8b,0xc5,0x53,0xb1,0x81,0xc3,0x25,0xf7,0xad,0xfe,0xd4,0x7a,0xa6,
0xc5,0x26,0xb3,0x38,0x58,0xd0,0xdf,0xf1,0x90,0x4e,0x03,0xe6,0x8f,0x3e,0xab,0xd5,
0x74,0x1f,0xd2,0xab,0x9b,0x9a,0x7c,0x55,0xd6,0x59,0xbc,0xfd,0x47,0xac,0x5e,0x1d,
0xb3,0x76,0xa1,0xb9,0xc7,0x2c,0x59,0xb6,0x13,0xa4,0x4c,0xde,0xfd,0x2a,0xbf,0xd7,
0x60,0x98,0x76,0x65,0x88,0x85,0x75,0xb0,0x54,0x5c,0x20,0xe1,0x92,0x87,0xc2,0x9d,
0x13,0x95,0x23,0xee,0x9b,0x5c,0x2e,0x05,0x8a,0x83,0x35,0xa7,0x23,0x93,0xf7,0x80,
0x29,0xdc,0x30,0x6b,0xc5,0xdc,0xb1,0xfb,0x84,0x20,0x96,0xd2,0xdc,0x79,0x8f,0x2d,
0x58,0x0c,0x2f,0x4f,0x16,0xba,0xd7,0x62,0x38,0xd7,0x8a,0xb1,0x1e,0x61,0xe9,0xa3,
0x17,0x7a,0x7d,0xc5,0x04,0xa0,0xc1,0x8f,0xf1,0x43,0xfc,0x1a,0x47,0x7d,0x15,0xbf,
0xc5,0x6f,0xf0,0x3b,0x7c,0x1c,0x2f,0x11,0x93,0x20,0x49,0x8a,0xb4,0xb5,0xf1,0xf4,
0x41,0xa6,0x2f,0x73,0xd0,0xc9,0xaf,0xce,0x6c,0x2e,0xcc,0x2d,0x3d,0x99,0x75,0x66,
0xe6,0x36,0xd6,0x7b,0x8d,0xd7,0x1f,0x3c,0x9e,0xb7,0x19,0x9f,0xd6,0x8f,0xb3,0x3f,
0x7e,0x74,0xa9,0x7c,0x9a,0xe8,0x03,0x37,0xa1,0x3f,0x08,0xb7,0x7b,0x3e,0x0d,0x6b,
0xf4,0xb3,0xa8,0x49,0xb4,0xc1,0x79,0x3f,0x5f,0x2f,0x13,0x2e,0xbb,0xa8,0x71,0x33,
0xa7,0xf4,0xad,0x9c,0xd1,0xaf,0x3a,0x90,0x2f,0x80,0xe1,0x11,0xc7,0x73,0x8d,0x31,
0xec,0x5b,0x8f,0xfd,0x32,0x04,0x30,0xfe,0x36,0xd0,0x1b,0x17,0xcb,0xa7,0x86,0xff,
0xbf,0x81,0x68,0x9e,0xb5,0x8c,0xfc,0x92,0x8d,0x66,0x0e,0x8c,0x5f,0xa9,0x4f,0x37,
0xa3,0x59,0xbe,0x62,0xbf,0x00,0x92,0xa7,0x65,0x73,0xbf,0x9e,0xe5,0xeb,0x87,0x7f,
0xbe,0x91,0x2b,0x34,0x07,0x6d,0x5f,0xa2,0xd2,0xab,0xc8,0xf7,0x7f,0x9a,0xf5,0x9c,
0x9f,0x9a,0xd7,0x18,0xdf,0x00,0x00,0x00,
// ASSEMBLER_EMBEDDED_CODE_END
};

typedef struct TCP_SERVER_T_
{
  struct tcp_pcb *server_pcb;
  bool complete;
  ip_addr_t gw;
  async_context_t *context;
} TCP_SERVER_T;

typedef struct TCP_CONNECT_STATE_T_
{
  struct tcp_pcb *pcb;
  int sent_len;
  int header_type;
  char headers[256];
  char result[4990];
  int header_len;
  int result_len;
  ip_addr_t *gw;
} TCP_CONNECT_STATE_T;

static err_t tcp_close_client_connection(TCP_CONNECT_STATE_T *con_state, struct tcp_pcb *client_pcb, err_t close_err)
{
  if (client_pcb) {
    assert(con_state && con_state->pcb == client_pcb);
    tcp_arg(client_pcb, NULL);
    tcp_poll(client_pcb, NULL, 0);
    tcp_sent(client_pcb, NULL);
    tcp_recv(client_pcb, NULL);
    tcp_err(client_pcb, NULL);
    err_t err = tcp_close(client_pcb);
    if (err != ERR_OK) {
      DEBUG_printf("close failed %d, calling abort\n", err);
      tcp_abort(client_pcb);
      close_err = ERR_ABRT;
    }
    if (con_state) {
      free(con_state);
    }
  }
  return close_err;
}

static void tcp_server_close(TCP_SERVER_T *state) {
  if (state->server_pcb) {
    tcp_arg(state->server_pcb, NULL);
    tcp_close(state->server_pcb);
    state->server_pcb = NULL;
  }
}

static err_t tcp_server_sent(void *arg, struct tcp_pcb *pcb, u16_t len) {
  TCP_CONNECT_STATE_T *con_state = (TCP_CONNECT_STATE_T*)arg;
  DEBUG_printf("tcp_server_sent %u\n", len);
  con_state->sent_len += len;
  if (con_state->sent_len >= con_state->header_len + con_state->result_len) {
    DEBUG_printf("all done\n");
    return tcp_close_client_connection(con_state, pcb, ERR_OK);
  }
  return ERR_OK;
}

static int test_server_content(TCP_CONNECT_STATE_T *con_state, const char *request, const char *params, char *result, size_t max_result_len)
{
  int len = 0;
  con_state->header_type = 0;
  
  if (strncmp(request, FONT_FILE_TEST, sizeof(FONT_FILE_TEST) - 1) == 0)
    {
      int font_len = sizeof(embedded_font);

      printf("\n----- Font file download");
      
      con_state->header_type = 1;
      memcpy(result, embedded_font, font_len);
      
      //      len = snprintf(result, max_result_len, "%s", embedded_font);
      return(font_len);
    }

  if (strncmp(request, FONT_TEST, sizeof(FONT_TEST) - 1) == 0)
    {
      con_state->header_type = 2;
      len = snprintf(result, max_result_len, EMBEDDED_FONT_URL_BODY);
      printf("\n----- Font file link request");
      printf("\n------ '%s'", result);
      return(len);
    }

  
  if (strncmp(request, LED_TEST, sizeof(LED_TEST) - 1) == 0)
    {
    // Get the state of the led
    bool value;

    cyw43_gpio_get(&cyw43_state, LED_GPIO, &value);

    int led_state = value;
    int key_state;
    
    int info_state = 0;
    
    // See if the user changed it
    if (params)
      {
	int led_param = sscanf(params, LED_PARAM, &led_state);

	if (led_param == 1)
	  {
	    if (led_state)
	      {
		// Turn led on
		cyw43_gpio_set(&cyw43_state, 0, true);
	      }
	    else
	      {
		// Turn led off
		cyw43_gpio_set(&cyw43_state, 0, false);
	      }
	  }

	int key_param = sscanf(params, KEY_PARAM, &key_state);

	// Push key into FSM
	queue_token(key_state);
      }
    
    // Generate result
    if (led_state)
      {
	len = snprintf(result, max_result_len, KB_BODY, get_display());
      }
    else
      {
	len = snprintf(result, max_result_len, KB_BODY, get_display());
      }


    //strcat(result, END_BODY);

    len = strlen(result);
    printf("\nresult len= %d\n", len);
    }
  return len;
}

err_t tcp_server_recv(void *arg, struct tcp_pcb *pcb, struct pbuf *p, err_t err)
{
  TCP_CONNECT_STATE_T *con_state = (TCP_CONNECT_STATE_T*)arg;
  if (!p)
    {
      DEBUG_printf("connection closed\n");
      return tcp_close_client_connection(con_state, pcb, ERR_OK);
    }
  
  assert(con_state && con_state->pcb == pcb);

  if (p->tot_len > 0)
    {
      DEBUG_printf("tcp_server_recv %d err %d\n", p->tot_len, err);
#if 0
      for (struct pbuf *q = p; q != NULL; q = q->next) {
	DEBUG_printf("in: %.*s\n", q->len, q->payload);
      }
#endif
      // Copy the request into the buffer
      pbuf_copy_partial(p, con_state->headers, p->tot_len > sizeof(con_state->headers) - 1 ? sizeof(con_state->headers) - 1 : p->tot_len, 0);

      printf("\n++++'%s'", con_state->headers);
      
      // Handle GET request
      if (strncmp(HTTP_GET, con_state->headers, sizeof(HTTP_GET) - 1) == 0)
	{
	  char *request = con_state->headers + sizeof(HTTP_GET); // + space
	  char *params = strchr(request, '?');
	  if (params)
	    {
	    if (*params)
	      {
	      char *space = strchr(request, ' ');
	      *params++ = 0;
	  if (space)
	    {
	      *space = 0;
	    }
	      }
	    else
	      {
		params = NULL;
	      }
	    }
	  
	  // Generate content
	  con_state->result_len = test_server_content(con_state, request, params, con_state->result, sizeof(con_state->result));
	  DEBUG_printf("Request: %s?%s\n", request, params);
	  DEBUG_printf("Result: %d\n", con_state->result_len);
	  
	  // Check we had enough buffer space
	  if (con_state->result_len > sizeof(con_state->result) - 1) {
	    DEBUG_printf("Too much result data %d\n", con_state->result_len);
	    return tcp_close_client_connection(con_state, pcb, ERR_CLSD);
	  }
	  
	  // Generate web page
	  if (con_state->result_len > 0)
	    {
	      switch( con_state->header_type)
		{
		case 0:
		  {
		    con_state->header_len = snprintf(con_state->headers, sizeof(con_state->headers), HTTP_RESPONSE_HEADERS,
						     200, con_state->result_len);
		    if (con_state->header_len > sizeof(con_state->headers) - 1)
		      {
			DEBUG_printf("Too much header data %d\n", con_state->header_len);
			return tcp_close_client_connection(con_state, pcb, ERR_CLSD);
		      }
		  }
		  break;
		  
		case 2:
		  {
		    con_state->header_len = snprintf(con_state->headers, sizeof(con_state->headers), HTTP_RESPONSE_FONT_CSS_HEADERS,
						     200, con_state->result_len);
		    if (con_state->header_len > sizeof(con_state->headers) - 1)
		      {
			DEBUG_printf("Too much header data %d\n", con_state->header_len);
			return tcp_close_client_connection(con_state, pcb, ERR_CLSD);
		      }
		  }
		  break;
		case 1:
		  {
		    con_state->header_len = snprintf(con_state->headers, sizeof(con_state->headers), HTTP_RESPONSE_FILE_DOWNLOAD,
						     "escfont.woff2", con_state->result_len);
		    printf("\n** header (download):'%s'\n",con_state->headers);
		    
		    if (con_state->header_len > sizeof(con_state->headers) - 1)
		      {
			DEBUG_printf("Too much header data %d\n", con_state->header_len);
			return tcp_close_client_connection(con_state, pcb, ERR_CLSD);
		      }
		  }
		  break;
		  
		}
	    }
	  else
	    {
	      // Send redirect
	      con_state->header_len = snprintf(con_state->headers, sizeof(con_state->headers), HTTP_RESPONSE_REDIRECT,
					       ipaddr_ntoa(con_state->gw));
	      DEBUG_printf("Sending redirect %s", con_state->headers);
	    }
	  
	  // Send the headers to the client
	  con_state->sent_len = 0;

	  err_t err = tcp_write(pcb, con_state->headers, con_state->header_len, 0);

	  if (err != ERR_OK)
	    {
	      DEBUG_printf("failed to write header data %d\n", err);
	      return tcp_close_client_connection(con_state, pcb, err);
	    }
	  
	  // Send the body to the client
	  if (con_state->result_len)
	    {
	      err = tcp_write(pcb, con_state->result, con_state->result_len, 0);
	      if (err != ERR_OK)
		{
		  DEBUG_printf("failed to write result data %d\n", err);
		  return tcp_close_client_connection(con_state, pcb, err);
		}
	    }
	}
      tcp_recved(pcb, p->tot_len);
    }
  
  pbuf_free(p);
  return ERR_OK;
}

static err_t tcp_server_poll(void *arg, struct tcp_pcb *pcb)
{
  TCP_CONNECT_STATE_T *con_state = (TCP_CONNECT_STATE_T*)arg;
  DEBUG_printf("tcp_server_poll_fn\n");
  return tcp_close_client_connection(con_state, pcb, ERR_OK); // Just disconnect clent?
}

static void tcp_server_err(void *arg, err_t err)
{
  TCP_CONNECT_STATE_T *con_state = (TCP_CONNECT_STATE_T*)arg;
  if (err != ERR_ABRT)
    {
      DEBUG_printf("tcp_client_err_fn %d\n", err);
      tcp_close_client_connection(con_state, con_state->pcb, err);
    }
}

static err_t tcp_server_accept(void *arg, struct tcp_pcb *client_pcb, err_t err)
{
  TCP_SERVER_T *state = (TCP_SERVER_T*)arg;
  if (err != ERR_OK || client_pcb == NULL)
    {
      DEBUG_printf("failure in accept\n");
      return ERR_VAL;
    }
  DEBUG_printf("client connected\n");
  
  // Create the state for the connection
  TCP_CONNECT_STATE_T *con_state = calloc(1, sizeof(TCP_CONNECT_STATE_T));
  if (!con_state)
    {
      DEBUG_printf("failed to allocate connect state\n");
      return ERR_MEM;
    }
  
  con_state->pcb = client_pcb; // for checking
  con_state->gw = &state->gw;
  
  // setup connection to client
  tcp_arg(client_pcb, con_state);
  tcp_sent(client_pcb, tcp_server_sent);
  tcp_recv(client_pcb, tcp_server_recv);
  tcp_poll(client_pcb, tcp_server_poll, POLL_TIME_S * 2);
  tcp_err(client_pcb, tcp_server_err);

  return ERR_OK;
}

static bool tcp_server_open(void *arg, const char *ap_name)
{
  TCP_SERVER_T *state = (TCP_SERVER_T*)arg;

  DEBUG_printf("starting server on port %d\n", TCP_PORT);

  struct tcp_pcb *pcb = tcp_new_ip_type(IPADDR_TYPE_ANY);

  if (!pcb)
    {
      DEBUG_printf("failed to create pcb\n");
      return false;
    }
  
  err_t err = tcp_bind(pcb, IP_ANY_TYPE, TCP_PORT);
  if (err)
    {
      DEBUG_printf("failed to bind to port %d\n",TCP_PORT);
      return false;
    }
  
  state->server_pcb = tcp_listen_with_backlog(pcb, 1);

  if (!state->server_pcb)
    {
      DEBUG_printf("failed to listen\n");
      if (pcb)
	{
	  tcp_close(pcb);
	}
      return false;
    }
  
  tcp_arg(state->server_pcb, state);
  tcp_accept(state->server_pcb, tcp_server_accept);
  
  printf("Try connecting to '%s' (press 'd' to disable access point)\n", ap_name);
  return true;
}

// This "worker" function is called to safely perform work when instructed by key_pressed_func
void key_pressed_worker_func(async_context_t *context, async_when_pending_worker_t *worker)
{
  assert(worker->user_data);
  printf("Disabling wifi\n");
  cyw43_arch_disable_ap_mode();
  ((TCP_SERVER_T*)(worker->user_data))->complete = true;
}

static async_when_pending_worker_t key_pressed_worker =
  {
   .do_work = key_pressed_worker_func
  };

void key_pressed_func(void *param) {
  assert(param);
  int key = getchar_timeout_us(0); // get any pending key press but don't wait
  if (key == 'd' || key == 'D')
    {
      // We are probably in irq context so call wifi in a "worker"
      async_context_set_work_pending(((TCP_SERVER_T*)param)->context, &key_pressed_worker);
    }
}

int wifi_main(void)
{
  stdio_init_all();
  
  TCP_SERVER_T *state = calloc(1, sizeof(TCP_SERVER_T));
  if (!state)
    {
      DEBUG_printf("failed to allocate state\n");
      return 1;
    }

  if (cyw43_arch_init())
    {
      DEBUG_printf("failed to initialise\n");
      return 1;
    }
  
  // Get notified if the user presses a key
  state->context = cyw43_arch_async_context();
  key_pressed_worker.user_data = state;
  async_context_add_when_pending_worker(cyw43_arch_async_context(), &key_pressed_worker);

  stdio_set_chars_available_callback(key_pressed_func, state);

  const char *ap_name = "SchoolsComputer";
#if 1
  const char *password = "schoolscomputer";
#else
  const char *password = NULL;
#endif

  cyw43_arch_enable_ap_mode(ap_name, password, CYW43_AUTH_WPA2_AES_PSK);

  ip4_addr_t mask;
  IP4_ADDR(ip_2_ip4(&state->gw), 192, 168, 4, 1);
  IP4_ADDR(ip_2_ip4(&mask), 255, 255, 255, 0);

  // Start the dhcp server
  dhcp_server_t dhcp_server;
  dhcp_server_init(&dhcp_server, &state->gw, &mask);

  // Start the dns server
  dns_server_t dns_server;

  dns_server_init(&dns_server, &state->gw);

  if (!tcp_server_open(state, ap_name))
    {
      DEBUG_printf("failed to open server\n");
      return 1;
    }
  
  state->complete = false;
  
  while(!state->complete)
    {
      // the following #ifdef is only here so this same example can be used in multiple modes;
      // you do not need it in your code
#if PICO_CYW43_ARCH_POLL
      // if you are using pico_cyw43_arch_poll, then you must poll periodically from your
      // main loop (not from a timer interrupt) to check for Wi-Fi driver or lwIP work that needs to be done.
      cyw43_arch_poll();
      // you can poll as often as you like, however if you have nothing else to do you can
      // choose to sleep until either a specified time, or cyw43_arch_poll() has work to do:
      cyw43_arch_wait_for_work_until(make_timeout_time_ms(1000));
#else
      // if you are not using pico_cyw43_arch_poll, then Wi-FI driver and lwIP work
      // is done via interrupt in the background. This sleep is just an example of some (blocking)
      // work you might be doing.
      //sleep_ms(1000);
      drive_fsms();
      serial_loop();
      update_display();
      
#endif
    }
  
  tcp_server_close(state);
  dns_server_deinit(&dns_server);
  dhcp_server_deinit(&dhcp_server);
  cyw43_arch_deinit();
  
  return 0;
}
